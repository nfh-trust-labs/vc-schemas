{
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "$id": "https://nfh-trust-labs.github.io/vc-schemas/energy-credentials/consumer-profile-vc/schema.json",
    "title": "Utility Consumer Credential Schema",
    "description": "JSON Schema for verifying Consumer/Prosumer Credentials issued by electricity distribution utilities. A pure consumer has no DER blocks, while a prosumer has at least one (derSolar or derBattery).",
    "type": "object",
    "required": [
        "@context",
        "id",
        "type",
        "issuer",
        "issuanceDate",
        "credentialSubject"
    ],
    "properties": {
        "@context": {
            "type": "array",
            "items": {
                "type": "string"
            },
            "contains": {
                "const": "https://www.w3.org/2018/credentials/v1"
            },
            "minItems": 2
        },
        "id": {
            "type": "string",
            "format": "uri",
            "pattern": "^urn:uuid:[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$",
            "description": "Unique identifier for the credential in URN UUID format"
        },
        "type": {
            "type": "array",
            "items": {
                "type": "string"
            },
            "contains": {
                "const": "UtilityConsumerCredential"
            },
            "minItems": 2
        },
        "issuer": {
            "type": "object",
            "required": ["id", "name", "licenseNumber"],
            "properties": {
                "id": {
                    "type": "string",
                    "format": "uri",
                    "description": "DID of the issuing distribution utility"
                },
                "name": {
                    "type": "string",
                    "minLength": 1,
                    "description": "Name of the distribution utility"
                },
                "licenseNumber": {
                    "type": "string",
                    "minLength": 1,
                    "description": "Regulatory license number issued by the local energy regulator"
                }
            }
        },
        "issuanceDate": {
            "type": "string",
            "format": "date-time",
            "description": "Date and time when the credential was issued"
        },
        "expirationDate": {
            "type": "string",
            "format": "date-time",
            "description": "Optional expiration date of the credential"
        },
        "credentialSubject": {
            "type": "object",
            "required": [
                "id",
                "consumerNumber",
                "fullName",
                "installationAddress",
                "premisesType",
                "connectionType",
                "sanctionedLoadKW",
                "tariffCategoryCode",
                "meterNumber",
                "serviceConnectionDate"
            ],
            "properties": {
                "id": {
                    "type": "string",
                    "format": "uri",
                    "description": "DID of the consumer/credential subject"
                },
                "consumerNumber": {
                    "type": "string",
                    "minLength": 1,
                    "description": "Unique consumer/customer account number assigned by the utility"
                },
                "fullName": {
                    "type": "string",
                    "minLength": 1,
                    "maxLength": 200,
                    "description": "Full name of the consumer as per ID proof"
                },
                "installationAddress": {
                    "type": "object",
                    "required": ["fullAddress", "postalCode", "country"],
                    "properties": {
                        "fullAddress": {
                            "type": "string",
                            "minLength": 1,
                            "maxLength": 500,
                            "description": "Complete street address of the installation"
                        },
                        "city": {
                            "type": "string",
                            "minLength": 1,
                            "description": "City name"
                        },
                        "district": {
                            "type": "string",
                            "minLength": 1,
                            "description": "District or county name"
                        },
                        "stateProvince": {
                            "type": "string",
                            "minLength": 1,
                            "description": "State, province, or region name"
                        },
                        "postalCode": {
                            "type": "string",
                            "minLength": 1,
                            "description": "Postal or ZIP code (format varies by country)"
                        },
                        "country": {
                            "type": "string",
                            "pattern": "^[A-Z]{2}$",
                            "description": "ISO 3166-1 alpha-2 country code"
                        }
                    }
                },
                "premisesType": {
                    "type": "string",
                    "enum": ["Residential", "Commercial", "Industrial", "Agricultural"],
                    "description": "Type of premises for the electricity connection"
                },
                "connectionType": {
                    "type": "string",
                    "enum": ["Single-phase", "Three-phase"],
                    "description": "Type of electrical connection"
                },
                "sanctionedLoadKW": {
                    "type": "number",
                    "minimum": 0.5,
                    "maximum": 10000,
                    "description": "Sanctioned/approved electrical load in kilowatts (kW)"
                },
                "tariffCategoryCode": {
                    "type": "string",
                    "minLength": 1,
                    "description": "Billing/tariff category code assigned by the utility"
                },
                "meterNumber": {
                    "type": "string",
                    "minLength": 1,
                    "maxLength": 50,
                    "description": "Unique meter serial number"
                },
                "serviceConnectionDate": {
                    "type": "string",
                    "format": "date",
                    "description": "Date when the connection was activated"
                },
                "derSolar": {
                    "type": "object",
                    "description": "Distributed Energy Resource - Solar installation details. If present, indicates the consumer is a prosumer with solar generation capability.",
                    "required": ["capacityKWp", "commissioningDate"],
                    "properties": {
                        "capacityKWp": {
                            "type": "number",
                            "minimum": 0.1,
                            "maximum": 10000,
                            "description": "Installed solar generation capacity in kilowatts peak (kWp)"
                        },
                        "commissioningDate": {
                            "type": "string",
                            "format": "date",
                            "description": "Date when solar installation was activated"
                        }
                    }
                },
                "derBattery": {
                    "type": "object",
                    "description": "Distributed Energy Resource - Battery storage details. If present, indicates the consumer is a prosumer with battery storage capability.",
                    "required": ["storageCapacityKWh", "powerRatingKW", "commissioningDate"],
                    "properties": {
                        "storageCapacityKWh": {
                            "type": "number",
                            "minimum": 0.1,
                            "maximum": 10000,
                            "description": "Battery storage capacity in kilowatt-hours (kWh)"
                        },
                        "powerRatingKW": {
                            "type": "number",
                            "minimum": 0.1,
                            "maximum": 10000,
                            "description": "Battery charge/discharge power rating in kilowatts (kW)"
                        },
                        "commissioningDate": {
                            "type": "string",
                            "format": "date",
                            "description": "Date when battery storage was activated"
                        }
                    }
                }
            }
        },
        "proof": {
            "type": "object",
            "required": ["type", "created", "verificationMethod", "proofPurpose", "proofValue"],
            "properties": {
                "type": {
                    "type": "string",
                    "description": "Cryptographic signature type (e.g., Ed25519Signature2020)"
                },
                "created": {
                    "type": "string",
                    "format": "date-time",
                    "description": "Timestamp when the proof was created"
                },
                "verificationMethod": {
                    "type": "string",
                    "format": "uri",
                    "description": "URI of the verification method/public key"
                },
                "proofPurpose": {
                    "type": "string",
                    "enum": ["assertionMethod", "authentication"],
                    "description": "Purpose of the proof"
                },
                "proofValue": {
                    "type": "string",
                    "minLength": 1,
                    "description": "The cryptographic signature value"
                }
            }
        }
    }
}
